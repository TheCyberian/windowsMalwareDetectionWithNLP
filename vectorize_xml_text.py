import os
import pandas as pd
from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer

labels = []
file_content = []


def vectorize_xml_text_files_in_path(path):
    for files in os.listdir(path):
        if "malicious_" in files:
            labels.append("-1")
        else:
            labels.append("1")
        filename = os.path.join(path, files)
        print("[INFO] Reading file :  " + filename)
        with open(filename, encoding='ascii', errors='ignore') as f:
            content = f.read()
            # content.replace(",", " ")
            file_content.append(content)
            print("[INFO] File text added to list...")

    print("[INFO] Vectorizing the texts in list...")

    # vectorizer = CountVectorizer(stop_words=None, max_features=5000, ngram_range=(2, 2))
    # TODO: 1. Apply TF-IDF vectorization as well
    vectorizer = TfidfVectorizer(stop_words=None, max_features=5000, ngram_range=(1, 1))
    dtm = vectorizer.fit_transform(file_content)

    df = pd.DataFrame(dtm.toarray(), index=labels, columns=vectorizer.get_feature_names())

    print("[INFO] Writing Dataframe to CSV file...")
    df.index.name = 'labels'
    df.to_csv('vectors/android_malware_bigrams.csv')

    # feature_list = vectorizer.get_feature_names()
    # for feature in feature_list:
    #     print(str(feature))

    print("[INFO] <<<<<<<<< Vectorization Completed >>>>>>>>>>>>")
